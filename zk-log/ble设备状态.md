**BLE设备的主要状态**

1. **待机状态（Standby State）**

- 描述
  - BLE设备默认处于待机状态，所有无线通信模块都关闭以节省能耗。
  - 只有外部事件（如定时器、外部中断）或应用程序请求才能将设备从待机状态唤醒。
- **功耗**：最低。
- **使用场景**：无操作时的默认状态。

2. **广播状态（Advertising State）**

- 描述
  - 从机通过广播信道（37、38、39）发送广播包，向主机发出存在信号。
  - 广播包中可以包含设备的基本信息（如名称、服务UUID等）。
- 类型
  - 可连接广播（Connectable Advertising）
    - 主机可以扫描到广播并请求连接。
  - 不可连接广播（Non-connectable Advertising）
    - 仅用于发送广播信息，不接受连接请求。
  - 定向广播（Directed Advertising）
    - 广播仅针对特定的主机地址。
  - 扫描响应广播（Scannable Advertising）
    - 可被主机扫描，主机收到广播后可以请求额外信息（扫描响应数据）。
- **功耗**：广播间隔较短时功耗较高，间隔长时功耗较低。
- **使用场景**：设备待连接、周期性广播数据等。

3. **扫描状态（Scanning State）**

- 描述
  - 主机设备在广播信道上扫描，从广播包中发现附近的BLE设备。
  - 如果扫描到目标设备，可以请求额外信息（扫描响应）。
- 类型
  - 主动扫描（Active Scanning）
    - 主机不仅接收广播包，还发送扫描请求，以获取扫描响应数据。
  - 被动扫描（Passive Scanning）
    - 主机仅接收广播包，不发送任何请求，功耗更低。
- **功耗**：取决于扫描间隔和扫描窗口的设置。
- **使用场景**：主机寻找目标设备。

4. **连接状态（Connection State）**

- 描述
  - 主机与从机建立连接后，双方通过已建立的连接信道进行数据通信。
  - 进入此状态后，从机会停止广播，主机会停止扫描。
- 特性
  - 数据传输使用加密和校验，连接更可靠。
  - 可以通过连接参数（如连接间隔、数据包大小）优化功耗。
- 功耗
  - 功耗由通信频率（连接间隔）和数据传输量决定，间隔较长时功耗较低。
- **使用场景**：文件传输、实时数据交互（如传感器数据）。



**BLE工作状态切换图**

以下是典型的状态切换路径：

1. 从机（Slave Device）

   - **待机** → **广播** → （主机连接请求） → **连接** → （断开连接） → **广播或待机**。

2. 主机（Master Device）

   - **待机** → **扫描** → （发现设备） → **连接请求** → **连接** → （断开连接） → **扫描或待机**。

   

------

**BLE状态优化功耗的关键**

1. **广播优化**：
   - 增大广播间隔（如100ms到几秒）。
   - 选择不可连接广播以降低功耗。
2. **扫描优化**：
   - 使用被动扫描。
   - 增大扫描间隔并缩短扫描窗口。
3. **连接优化**：
   - 增大连接间隔（如100ms以上）。
   - 减少数据传输量。
4. **待机优化**：
   - 尽可能让设备保持待机状态，使用低功耗定时器唤醒。

