
<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<title>13.zephyr创建自己的board</title>
<style>
body { margin: 0; padding: 0; font-family: sans-serif; background: #f5f5f5; }
#wrapper { max-width: 950px; margin: 0 auto; padding-right: 300px; }
#content {
    background: #fff;
    padding: 40px;
    min-height: 100vh;
    box-shadow: 0 2px 14px #eee;
}
#content img {
    display: block;
    margin: 24px auto;
    max-width: 100%;
    height: auto;
    box-shadow: 0 4px 12px #eee;
    background: #fff;
}
#content pre {
    background: #fafbfc;
    border-radius: 6px;
    padding: 16px;
    margin: 20px 0;
    overflow-x: auto;
    font-size: 16px;
}
#content pre:empty {
    display: none;
}
#content div:empty {
    min-height: 0 !important;
    background: none !important;
}
#toc {
    position: fixed;
    top: 0;
    right: 0;
    width: 270px;
    height: 100vh;
    overflow-y: auto;
    background: #f8f8f8;
    border-left: 1px solid #e0e0e0;
    padding: 32px 16px 32px 24px;
    box-shadow: -3px 0 7px 0 #eee;
    z-index: 100;
}
#toc ul {
    list-style: none;
    padding-left: 0;
    margin: 0;
}
#toc ul ul {
    padding-left: 18px;
    border-left: 2px solid #e0e0e0;
    margin-left: 8px;
}
#toc li {
    margin-bottom: 3px;
}
#toc a {
    color: #222;
    text-decoration: none;
    font-size: 15px;
    transition: color 0.2s;
}
#toc a:hover {
    color: #1a73e8;
}
@media (max-width: 1200px) {
    #toc { display: none; }
    #wrapper { padding-right: 0; }
}
</style>
</head>
<body>
<div id="wrapper">
    <div id="content">
        <h1 id="zephyrboard">zephyr创建自己的board</h1>
<p>参考官方说明 https://docs.zephyrproject.org/latest/hardware/porting/board_porting.html#board-porting-guide</p>
<p>上一节在原zephyr工程中创建了一个自己的目录以便开发</p>
<ul>
<li>查找自己mcu是否支持zephyr https://docs.zephyrproject.org/latest/boards/index.html#    </li>
<li>或者在zephyr的boards目录中查看</li>
<li>目前主要支持 nordic  ST 以及NXP，intel 瑞萨    聆思科技要去官网下载他们的sdk   nordic完全支持zephyr了，也是要去官网下载他们的sdk</li>
<li>国产芯片厂大多数都没有</li>
</ul>
<p><img alt="image-20250802123105341" src="https://newbie-typora.oss-cn-shenzhen.aliyuncs.com/TyporaJPG/image-20250802123105341.png" /></p>
<p>我使用的是stm32h7s78-dk,在boards内有支持，所以直接使用就好了，只需要更改一下名字就好了</p>
<p>一般来说适配自己的boards首先看芯片有没有支持，有支持再找同样芯片的board或者相近似的board，更改名字以及设备树</p>
<p>主板目录名无需与主板名称一致。甚至可以将多个主板定义在一个目录中</p>
<p>board 目录应如下所示：</p>
<pre><code>boards/&lt;VENDOR&gt;/plank
├── board.yml
├── board.cmake
├── CMakeLists.txt
├── doc
│   ├── plank.webp
│   └── index.rst
├── Kconfig.plank
├── Kconfig.defconfig
├── plank_&lt;qualifiers&gt;_defconfig
├── plank_&lt;qualifiers&gt;.dts
└── plank_&lt;qualifiers&gt;.yaml
</code></pre>
<p>必需的文件包括：</p>
<ol>
<li><code>board.yml</code>：一个 YAML 文件，用于描述开发板的高级元数据，例如开发板名称、SoC 及其变体。多核 SoC 的 CPU 集群未在此文件中描述，因为它们继承自 SoC 的 YAML 描述。</li>
<li><code>plank_&lt;qualifiers&gt;.dts</code><a href="https://docs.zephyrproject.org/latest/build/dts/index.html#dt-guide">：设备</a>树格式的硬件描述。它声明了您的 SoC、连接器以及任何其他硬件组件，例如 LED、按钮、传感器或通信外设（USB、蓝牙控制器等）。</li>
<li><code>Kconfig.plank</code>：用于选择 SoC 以及其他开发板和 SoC 相关设置的基本软件配置。不得选择开发板和 SoC 树之外的 Kconfig 设置。要选择常规 Zephyr Kconfig 设置，<code>Kconfig</code>必须使用该文件。</li>
</ol>
<p>可选文件包括：</p>
<ul>
<li><code>Kconfig</code>，<a href="https://docs.zephyrproject.org/latest/build/kconfig/index.html#kconfig">配置系统 (Kconfig)</a><code>Kconfig.defconfig</code>格式的软件配置 。这为软件功能和外设驱动程序提供了默认设置。</li>
<li><code>plank_defconfig</code>和<code>plank_&lt;qualifiers&gt;_defconfig</code>：Kconfig 格式的软件配置<code>.conf</code>。</li>
<li><code>board.cmake</code>：用于<a href="https://docs.zephyrproject.org/latest/hardware/porting/board_porting.html#flash-and-debug-support">Flash 和调试支持</a></li>
<li><code>CMakeLists.txt</code>：如果您需要向您的构建添加额外的源文件。</li>
<li><code>doc/index.rst</code>，<code>doc/plank.webp</code>：开发板的文档和图片。只有当你将<a href="https://docs.zephyrproject.org/latest/hardware/porting/board_porting.html#contributing-your-board">开发板贡献</a>给 Zephyr 时才需要这些。</li>
<li><code>plank_&lt;qualifiers&gt;.yaml</code><a href="https://docs.zephyrproject.org/latest/develop/test/twister.html#twister-script">：包含测试运行器（Twister）</a>使用的各种元数据的 YAML 文件。</li>
</ul>
<p>形式为 的板限定符<code>&lt;soc&gt;/&lt;cpucluster&gt;/&lt;variant&gt;</code>被规范化，以便在用于文件名时<code>/</code>被替换为<code>_</code>，例如： 在用于文件名时<code>soc1/foo</code>变为。<code>soc1_foo</code></p>
<h2 id="1board">1.更改board文件名字</h2>
<p><img alt="image-20250802194635503" src="https://newbie-typora.oss-cn-shenzhen.aliyuncs.com/TyporaJPG/image-20250802194635503.png" /></p>
<p><img alt="image-20250802194615605" src="https://newbie-typora.oss-cn-shenzhen.aliyuncs.com/TyporaJPG/image-20250802194615605.png" /></p>
<p>更改board名字，虽然可以与目录不一致，但是为了方便查找，最好还是一致吧</p>
<h2 id="2boardyml">2.更改board.yml文件</h2>
<p>原文件</p>
<pre><code>board:
  name: stm32h7s78_dk
  full_name: STM32H7S78-DK Discovery
  vendor: st
  socs:
    - name: stm32h7s7xx
</code></pre>
<p>更改后</p>
<ul>
<li>更改 name: h7s78</li>
</ul>
<pre><code>board:
  name: h7s78
  full_name: STM32H7S78-DK Discovery
  vendor: st
  socs:
    - name: stm32h7s7xx
</code></pre>
<h2 id="3-h7s78yaml">3.更改 h7s78.yaml</h2>
<p>更改前</p>
<pre><code>identifier: stm32h7s78_dk
name: ST STM32H7S78 Discovery Kit
type: mcu
arch: arm
toolchain:
  - zephyr
ram: 640
flash: 64
supported:
  - arduino_gpio
  - gpio
  - uart
  - watchdog
  - entropy
  - adc
  - octospi
  - usbd
  - memc
vendor: st
</code></pre>
<p>更改后</p>
<ul>
<li>更改 identifier: h7s78</li>
</ul>
<pre><code>identifier: h7s78
name: ST STM32H7S78 Discovery Kit
type: mcu
arch: arm
toolchain:
  - zephyr
ram: 640
flash: 64
supported:
  - arduino_gpio
  - gpio
  - uart
  - watchdog
  - entropy
  - adc
  - octospi
  - usbd
  - memc
vendor: st
</code></pre>
<h2 id="4kconfigdefconfig">4.更改Kconfig.defconfig</h2>
<p>更改前</p>
<pre><code># STM32H7S78 DISCOVERY KIT board configuration
#
# Copyright (c) 2024 STMicroelectronics
#
# SPDX-License-Identifier: Apache-2.0
#

if BOARD_STM32H7S78_DK

if NETWORKING

config NET_L2_ETHERNET
    default y

endif # NETWORKING

endif # BOARD_STM32H7S78_DK

</code></pre>
<p>更改后</p>
<pre><code># STM32H7S78 DISCOVERY KIT board configuration
#
# Copyright (c) 2024 STMicroelectronics
#
# SPDX-License-Identifier: Apache-2.0
#

if BOARD_H7S78

if NETWORKING

config NET_L2_ETHERNET
    default y

endif # NETWORKING

endif # BOARD_H7S78
</code></pre>
<h2 id="5kconfigh7s78">5.更改Kconfig.h7s78</h2>
<p>更改前</p>
<pre><code># STM32H7S78-DK Discovery kit board configuration
#
# Copyright (c) 2024 STMicroelectronics
#
# SPDX-License-Identifier: Apache-2.0
#

config BOARD_STM32H7S78_DK
    select SOC_STM32H7S7XX

</code></pre>
<p>更改后</p>
<pre><code># STM32H7S78-DK Discovery kit board configuration
#
# Copyright (c) 2024 STMicroelectronics
#
# SPDX-License-Identifier: Apache-2.0
#

config BOARD_H7S78
    select SOC_STM32H7S7XX
</code></pre>
<h2 id="_1">编译命令</h2>
<ul>
<li>在哪一个目录编译就会将编译的信息生成到该目录</li>
</ul>
<p>zephyrproject/h7s78-dk-example 目录下   （此处最好使用绝对路径来制定boards） </p>
<pre><code> west build -p always -b h7s78 1.blinky -DBOARD_ROOT=/home/hdj/zephyrproject/h7s78-dk-example
</code></pre>
<p><img alt="image-20250802195739154" src="https://newbie-typora.oss-cn-shenzhen.aliyuncs.com/TyporaJPG/image-20250802195739154.png" /></p>
<p>zephyrproject/h7s78-dk-example/1.blinky 目录</p>
<pre><code>west build -p always -b h7s78 ../1.blinky -DBOARD_ROOT=/home/hdj/zephyrproject/h7s78-dk-example
</code></pre>
    </div>
</div>
<div id="toc">
    <div style="font-weight:bold;margin-bottom:12px;">目录</div>
    <div class="toc">
<ul>
<li><a href="#zephyrboard">zephyr创建自己的board</a><ul>
<li><a href="#1board">1.更改board文件名字</a></li>
<li><a href="#2boardyml">2.更改board.yml文件</a></li>
<li><a href="#3-h7s78yaml">3.更改 h7s78.yaml</a></li>
<li><a href="#4kconfigdefconfig">4.更改Kconfig.defconfig</a></li>
<li><a href="#5kconfigh7s78">5.更改Kconfig.h7s78</a></li>
<li><a href="#_1">编译命令</a></li>
</ul>
</li>
</ul>
</div>

</div>
</body>
</html>
