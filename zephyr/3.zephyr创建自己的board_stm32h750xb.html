
<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<title>3.zephyr创建自己的board_stm32h750xb</title>
<style>
body { margin: 0; padding: 0; font-family: sans-serif; background: #f5f5f5; }
#wrapper { max-width: 950px; margin: 0 auto; padding-right: 300px; }
#content {
    background: #fff;
    padding: 40px;
    min-height: 100vh;
    box-shadow: 0 2px 14px #eee;
}
#content img {
    display: block;
    margin: 24px auto;
    max-width: 100%;
    height: auto;
    box-shadow: 0 4px 12px #eee;
    background: #fff;
}
#content pre {
    background: #fafbfc;
    border-radius: 6px;
    padding: 16px;
    margin: 20px 0;
    overflow-x: auto;
    font-size: 16px;
}
#content pre:empty {
    display: none;
}
#content div:empty {
    min-height: 0 !important;
    background: none !important;
}
#toc {
    position: fixed;
    top: 0;
    right: 0;
    width: 270px;
    height: 100vh;
    overflow-y: auto;
    background: #f8f8f8;
    border-left: 1px solid #e0e0e0;
    padding: 32px 16px 32px 24px;
    box-shadow: -3px 0 7px 0 #eee;
    z-index: 100;
}
#toc ul {
    list-style: none;
    padding-left: 0;
    margin: 0;
}
#toc ul ul {
    padding-left: 18px;
    border-left: 2px solid #e0e0e0;
    margin-left: 8px;
}
#toc li {
    margin-bottom: 3px;
}
#toc a {
    color: #222;
    text-decoration: none;
    font-size: 15px;
    transition: color 0.2s;
}
#toc a:hover {
    color: #1a73e8;
}
@media (max-width: 1200px) {
    #toc { display: none; }
    #wrapper { padding-right: 0; }
}
</style>
</head>
<body>
<div id="wrapper">
    <div id="content">
        <h2 id="zephyrboard">zephyr创建自己的board</h2>
<p>注：当前使用的版本为 4.10</p>
<p>这里先说一下编译board的命令：</p>
<pre><code>west build -p always -b &lt;your-board-name&gt; samples\basic\blinky
</code></pre>
<p>这里的<your-board-name> 可以替换为 boards目录里的任意一个开发板    samples\basic\blinky 目录可以替换为其他示例 </p>
<ul>
<li>west boards 命令可查看所有开发板</li>
</ul>
<p>首先尝试编译一下 stm32h750_dk</p>
<pre><code>west build -p always -b stm32h750_dk samples\basic\blinky
</code></pre>
<p><img alt="image-20250407234105542" src="https://newbie-typora.oss-cn-shenzhen.aliyuncs.com/TyporaJPG/image-20250407234105542.png" /></p>
<p>上述中可以看到编译成功了，打印信息也可以看到编译出的文件路径在 zephyrproject/zephyr/build/zephyr/</p>
<p><img alt="image-20250407234442192" src="https://newbie-typora.oss-cn-shenzhen.aliyuncs.com/TyporaJPG/image-20250407234442192.png" /></p>
<h2 id="stm32h750_dk-board">使用stm32h750_dk 改造自己的board</h2>
<p>复制相同芯片的board或者相近的芯片board</p>
<p>开发板使用的是ART-PI    芯片型号为STM32H750XB   ，官方的仓库中正好有这个芯片，拿过来直接用，小改一下</p>
<p><img alt="image-20250407231501562" src="https://newbie-typora.oss-cn-shenzhen.aliyuncs.com/TyporaJPG/image-20250407231501562.png" /></p>
<h2 id="_1">更改文件名</h2>
<p>复制  stm32h750b_dk整个目录到同级目录 并更名称为art_pi，打开该目录</p>
<p>将原本的文件名称更改  ，这里需要更改4个文件名，如下</p>
<ul>
<li>更改前</li>
</ul>
<p><img alt="image-20250407232149139" src="https://newbie-typora.oss-cn-shenzhen.aliyuncs.com/TyporaJPG/image-20250407232149139.png" /></p>
<ul>
<li>更改后</li>
</ul>
<p><img alt="image-20250407232042799" src="https://newbie-typora.oss-cn-shenzhen.aliyuncs.com/TyporaJPG/image-20250407232042799.png" /></p>
<h2 id="boards">boards文件解析</h2>
<pre><code class="language-C">.
|-- Kconfig.art_pi 
|-- Kconfig.defconfig
|-- arduino_r3_connector.dtsi
|-- art_pi.dts
|-- art_pi.yaml
|-- art_pi_defconfig
|-- board.cmake
|-- board.yml
|-- doc
|   |-- img
|   `-- index.rst
`-- support
    `-- openocd.cfg

</code></pre>
<h3 id="_2">文件简介</h3>
<h3 id="1-kconfig">1. Kconfig 文件</h3>
<ol>
<li><strong>Kconfig.art_pi</strong></li>
<li>声明或定义与此板卡相关的 Kconfig 选项，比如板卡特定的外设功能开关等。</li>
<li>可以在这里使用 <code>config XYZ ...</code> 的方式给板卡提供可选配置（不一定所有板都需要单独一个 Kconfig.xx 文件，具体看需求）。</li>
<li><strong>Kconfig.defconfig</strong></li>
<li>定义此板卡默认启用或禁用的 Kconfig 选项（defconfig）。</li>
<li>当用户指定 <code>BOARD=art_pi</code> 时，系统会自动读取这里的配置，合并到最终的 <code>.config</code> 中。</li>
<li>常见用法是给一些选项赋默认值，比如 <code>CONFIG_UART_CONSOLE=y</code>，以保证板卡最基本的功能可用。</li>
<li><strong>art_pi_defconfig</strong></li>
<li>有时也用来放置默认的 Kconfig 设置，和 <code>Kconfig.defconfig</code> 类似，具体取决于工程组织方式。</li>
<li>不同项目中可能命名方式有差异，重要的是它用于声明板卡的默认配置。</li>
</ol>
<hr />
<h3 id="2-device-tree">2. 设备树 (Device Tree) 文件</h3>
<ol>
<li><strong>art_pi.dts</strong></li>
<li>此板卡的主设备树文件，描述硬件的资源映射、外设地址、引脚配置等。</li>
<li>Zephyr 编译时会根据 <code>.dts</code> 文件生成对应的 C 头文件来管理硬件初始化。</li>
<li>里面通常包含 CPU、时钟、串口、GPIO、SPI、I2C 等外设节点。</li>
<li><strong>arduino_r3_connector.dtsi</strong></li>
<li><code>.dtsi</code> 表示 Device Tree “include” 文件，是可以被其他 <code>.dts</code> 文件包含的公用片段。</li>
<li>通常用于描述通用的硬件接口或扩展接口（如 Arduino R3 接口的引脚映射），再在 <code>art_pi.dts</code> 中 <code>#include</code> 进去。</li>
<li>好处是可以复用或单独维护这些接口片段。</li>
</ol>
<hr />
<h3 id="3">3. 板卡元数据和构建信息</h3>
<ol>
<li><strong>art_pi.yaml</strong></li>
<li>描述板卡的元数据，比如名称、架构、SOC 型号、RAM/FLASH 大小、调试信息等。</li>
<li>被 Zephyr 的构建系统、测试工具、文档系统（如 <code>twister</code>）用来识别并管理板卡。</li>
<li>常见字段包括 <code>board:</code>, <code>name:</code>, <code>arch:</code>, <code>toolchain:</code>, <code>ram:</code> 等。</li>
<li><strong>board.cmake</strong></li>
<li>针对该板卡可能需要的一些特定 CMake 构建逻辑、编译标志或额外脚本。</li>
<li>一般可以在这里做板卡专用的编译选项或链接选项配置。</li>
<li>有些板卡无需此文件，如果没有特殊编译需求就可以省略。</li>
<li><strong>board.yml</strong></li>
<li>这是另一个用来描述板卡信息的 YAML 文件，和 <code>art_pi.yaml</code> 作用相似或者是配合使用，取决于项目组织。</li>
<li>可能被 Zephyr 的测试框架或文档系统用来标记板卡的特征与分类（例如：是否支持 BLE、是否有以太网等）。</li>
</ol>
<hr />
<h3 id="4">4. 文档相关</h3>
<ol>
<li><strong>doc/</strong> 目录</li>
<li>存放此板卡的使用说明、原理图或接线图等文档资料。</li>
<li>通常有一个 <code>index.rst</code> 入口，用 reStructuredText 格式写文档，可被 Sphinx 或 Zephyr 官方文档系统解析。</li>
<li><code>img/</code> 可以放板卡图片、接口示意图等。</li>
<li><strong>doc/index.rst</strong></li>
<li>该板卡文档的主入口，一般会在其中介绍：<ul>
<li>板卡的硬件概览（CPU、外设、存储等）</li>
<li>依赖的工具链、编译方法</li>
<li>如何下载固件、调试</li>
</ul>
</li>
<li>如果集成到 Zephyr 官方文档中，可以通过 Sphinx 生成在线文档。</li>
</ol>
<hr />
<h3 id="5">5. 调试/烧录相关</h3>
<ol>
<li><strong>support/openocd.cfg</strong></li>
<li>针对该板卡的 OpenOCD 配置脚本，用于调试或烧录。</li>
<li>包含硬件复位、JTAG/SWD 引脚、Flash 设置等信息，让 OpenOCD 知道如何和此板卡交互。</li>
<li>Zephyr 可以在编译完成后，使用 <code>west flash</code> / <code>west debug</code> 自动调用这个脚本进行下载或单步调试（如果你配置了 OpenOCD）。</li>
</ol>
<hr />
<h3 id="_3">总结</h3>
<ul>
<li><strong>Kconfig.xxx / defconfig</strong>：在编译配置层面控制板卡可选功能。</li>
<li><strong>.dts / .dtsi</strong>：在设备树层面描述硬件资源。</li>
<li><strong>.yaml / .yml</strong>：记录板卡元信息，供构建系统和测试文档系统识别。</li>
<li><strong>board.cmake</strong>：自定义编译逻辑（若有需要）。</li>
<li><strong>doc/</strong>：板卡文档、图片、示例说明等。</li>
<li><strong>support/openocd.cfg</strong>：调试/烧录所需的脚本。</li>
</ul>
<p>这些文件共同组成了 Zephyr 对该板卡的完整支持，涵盖从编译配置、硬件抽象到文档与调试的方方面面。</p>
<h2 id="board">编辑更改board信息</h2>
<p>具体可以看我的文件，不贴出来了</p>
<h2 id="_4">创建应用</h2>
<p>编译示例demo是使用  samples\basic\blinky，创建一个自己的项目放在那里？</p>
<p>一般来说放在 zephyr的同级目录， zephyr可以更新到最新版，不影响自己的应用，如下，创建一个项目文件夹art_pi_app</p>
<p><img alt="image-20250407234943643" src="https://newbie-typora.oss-cn-shenzhen.aliyuncs.com/TyporaJPG/image-20250407234943643.png" /></p>
<p>将blinky目录下的所有文件拷贝过来，小改一下dts文件 即可，当前主要是LED的适配与uart适配具体可看源码</p>
<p>编译：</p>
<pre><code>west build -p always -b art_pi ..\art_pi_app

west build -p always -b art_pi samples\basic\blinky


</code></pre>
<p>.. 表示上一级目录</p>
<p><img alt="image-20250407235407450" src="https://newbie-typora.oss-cn-shenzhen.aliyuncs.com/TyporaJPG/image-20250407235407450.png" /></p>
<p>至此编译完成，点亮一个led需要遵循 blinky 对设备树的描述，当前使用STM32CubeProgrammer 下载bin文件，烧录后系统无反应，下一节解决</p>
    </div>
</div>
<div id="toc">
    <div style="font-weight:bold;margin-bottom:12px;">目录</div>
    <div class="toc">
<ul>
<li><a href="#zephyrboard">zephyr创建自己的board</a></li>
<li><a href="#stm32h750_dk-board">使用stm32h750_dk 改造自己的board</a></li>
<li><a href="#_1">更改文件名</a></li>
<li><a href="#boards">boards文件解析</a><ul>
<li><a href="#_2">文件简介</a></li>
<li><a href="#1-kconfig">1. Kconfig 文件</a></li>
<li><a href="#2-device-tree">2. 设备树 (Device Tree) 文件</a></li>
<li><a href="#3">3. 板卡元数据和构建信息</a></li>
<li><a href="#4">4. 文档相关</a></li>
<li><a href="#5">5. 调试/烧录相关</a></li>
<li><a href="#_3">总结</a></li>
</ul>
</li>
<li><a href="#board">编辑更改board信息</a></li>
<li><a href="#_4">创建应用</a></li>
</ul>
</div>

</div>
</body>
</html>
